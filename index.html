<!doctype html>
<html>
<head><title>JS Example</title></head>
<body>

<div id="my-div">
  Type "s" to start drawing!
</div>

<div>
  <button id="change-color">Change color</button>
</div>

<div>
  <button id="alert-text">Alert the text</button>
</div>

<div>
  <button id="replay">Replay</button>
  <input type="range" id="range-slider">
</div>

<script>

  // when you setup variables at the top-level like this, they are effectively global variables
  // which are available to all functions
  var tracking = false;
  var coordinates = [];
  var currentCoordinateIndex = 0;
  var replayDiv;
  var trackingDivs = [];

  // functions can also be defined as properties of javascript objects, like the ones underneath here.
  // You can call these functions by writing ButtonEventHandlers.changeColor()
  var ButtonEventHandlers = {
    changeColor: function () {
      var element = document.getElementById("my-div");
      element.style.backgroundColor = "#ccc";
    },

    alertText: function () {
      var element = document.getElementById("my-div");
      alert(element.innerText);
    },

    toggleTracking: function (event) {
      if (!tracking) {
        document.body.style.backgroundColor = "gray";
        coordinates = [];
        trackingDivs = [];
        tracking = true;
      } else {
        document.body.style.backgroundColor = "";
        tracking = false;
        clearTrackingDivs();
      }
    }
  };

  function clearTrackingDivs() {
    trackingDivs.forEach(function (div) {
      div.remove();
    });
    trackingDivs = [];
  }

  function wireUpButtons() {

    var changeColorButton = document.getElementById("change-color");
    changeColorButton.addEventListener("click", ButtonEventHandlers.changeColor);

    var alertTextButton = document.getElementById("alert-text");
    alertTextButton.addEventListener("click", ButtonEventHandlers.alertText);

    var replayButton = document.getElementById("replay");
    replayButton.addEventListener("click", function () {
      clearTrackingDivs();
      currentCoordinateIndex = -1;
      replayDiv = document.createElement("div");
      replayDiv.style.height = "20px";
      replayDiv.style.width = "20px";
      replayDiv.style.borderRadius = "10px";
      replayDiv.style.backgroundColor = "gold";
      replayDiv.style.position = "absolute";
      document.body.appendChild(replayDiv);
      positionReplayDiv();
    });

  }

  // functions in javascript can be free-floating, at the top-level, like this one
  function positionReplayDiv() {
    currentCoordinateIndex++;

    // when you have a javascript object like {x: 1, y: 0} you can access the properties in two different ways:
    //    position.x OR position["x"] - kinda like a combination of a ruby hash and a ruby object
    var x = coordinates[currentCoordinateIndex].x;
    var y = coordinates[currentCoordinateIndex]["y"];

    // if you add a string to a number, you get a string...
    // so these calls will set the `top` and `left` CSS properties of the div to things like `44px`
    replayDiv.style.top = y + "px";
    replayDiv.style.left = x + "px";

    var otherDiv = document.createElement("div");
    otherDiv.style.height = "4px";
    otherDiv.style.width = "4px";
    otherDiv.style.backgroundColor = "black";
    otherDiv.style.position = "absolute";
    otherDiv.style.top = y + "px";
    otherDiv.style.left = x + "px";
    trackingDivs.push(otherDiv);
    document.body.appendChild(otherDiv);


    if (currentCoordinateIndex < coordinates.length - 1) {

      // this call to setTimeout tells the browser to execute the positionReplayDiv function after 20 milliseconds
      setTimeout(positionReplayDiv, document.getElementById("range-slider").value);

    } else {

      // this call tells the `replayDiv` to remove itself from the DOM
      // which makes it disappear from the page
      replayDiv.remove();

    }
  }

  // document event listeners

  // When you press a key, it calls an anonymous function defined right here
  document.addEventListener("keypress", function (event) {
    if (event.which == 115) {
      clearTrackingDivs();
      ButtonEventHandlers.toggleTracking();
    }
  });

  // *When* the browser has downloaded all of the HTML and is ready to process events,
  // call the wireUpButtons function
  document.addEventListener("DOMContentLoaded", wireUpButtons);

  // *When* the mouse moves, call an anonymous function
  document.addEventListener("mousemove", function (event) {

    // if the global variable named `tracking` is truthy, add the mouse's coordinates to
    // the global variable named `coordinates`
    if (tracking) {

      // `event` is a variable that the browser passes into this anonymous function.
      // The mousemove event has properties for `x` and `y` that describe the position of the mouse
      // You can create javascript objects with the `{}` literal
      var mousePosition = {x: event.x, y: event.y};
      coordinates.push(mousePosition);

      var otherDiv = document.createElement("div");
      otherDiv.style.height = "4px";
      otherDiv.style.width = "4px";
      otherDiv.style.backgroundColor = "black";
      otherDiv.style.position = "absolute";
      otherDiv.style.top = event.y + "px";
      otherDiv.style.left = event.x + "px";
      trackingDivs.push(otherDiv);
      document.body.appendChild(otherDiv);
    }
  });

</script>
</body>
</html>